<!DOCTYPE html>
<html class="iframe-h">

	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>网站后台管理模版</title>
		<link rel="stylesheet" type="text/css" href="/admin/layui/css/layui.css" />
		<link rel="stylesheet" type="text/css" href="/admin/css/admin.css" />
	</head>

	<body>
		<div class="wrap-container clearfix">
				<div class="column-content-detail">
					<form class="layui-form" action="">
						<div class="layui-form-item">
							<div class="layui-inline tool-btn">
								<button class="layui-btn layui-btn-small layui-btn-normal addBtn" data-url="article-add.html"><i class="layui-icon">&#xe654;</i></button>
								<button class="layui-btn layui-btn-small layui-btn-danger delBtn"  data-url="article-add.html"><i class="layui-icon">&#xe640;</i></button>
								<button class="layui-btn layui-btn-small layui-btn-warm listOrderBtn hidden-xs" data-url="article-add.html"><i class="iconfont">&#xe656;</i></button>
							</div>
							<div class="layui-inline">
								<input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
							</div>
							<div class="layui-inline">
								<select name="states" lay-filter="status">
									<option value="">请选择一个状态</option>
									<option value="010">正常</option>
									<option value="021">停止</option>
									<option value="0571">删除</option>
								</select>
							</div>
							<button class="layui-btn layui-btn-normal" lay-submit="search">搜索</button>
						</div>
					</form>
				
						<table class="layui-hide" id="orderList"
						 lay-even lay-skin="nob" lay-filter="demo">
                                <!-- <thead>
                                   <tr>
                                       <th lay-data="{field:'id', width:80, sort: true}">ID</th>
                                       <th lay-data="{field:'buyerName', width:80}">购买人姓名</th>
                                       <th lay-data="{field:'tel', width:80}">电话</th>
                                       <th lay-data="{field:'address'}">地址</th>
                                       <th lay-data="{field:'variety'}">化肥品种</th>
                                       <th lay-data="{field:'unitPrice', sort: true}">单价 （元/斤）</th>
                                       <th lay-data="{field:'count', sort: true}">数量总数（斤）</th>
                                       <th lay-data="{field:'totalPrice' ,sort: true}">总金额</th>
                                       <th lay-data="{field:'payPrice', sort: true}">已付金额</th>
                                       <th lay-data="{field:'owePrice', sort: true}">所欠金额</th>
                                       <th lay-data="{field:'date', sort: true}">购买日期</th>

                                  </tr>
                                 </thead> -->
						</table>
                        <script type="text/html" id="barDemo">
                             <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
                             <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
                             <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">结算</a>
                        </script>
                        <script type="text/html" id="statusTpl">
                             {{# if(d.payStatus == '0') {  }}
                                  <span>未结算</span>
                             {{#  }else{                  }}
                                  <span>已结算</span>
                             {{#  }                       }}
                        </script>
				</div>
		</div>
		<script src="/admin/layui/layui.all.js" type="text/javascript" charset="utf-8"></script>
		<script src="/admin/js/common.js" type="text/javascript" charset="utf-8"></script>
		<script th:src="@{/jquery-1.10.2.js}"></script>
		<script>
		     
		    function getURL(){
		    	var curWwwPath=window.document.location.href;
				console.log(curWwwPath);
			    //获取主机地址之后的目录，如： uimcardprj/share/meun.jsp
			    var pathName=window.document.location.pathname;
			    var pos=curWwwPath.indexOf(pathName);
			    //获取主机地址，如： http://localhost:8083
			    var localhostPaht=curWwwPath.substring(0,pos);
			    //获取带"/"的项目名，如：/uimcardprj
			    var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1);
			    return localhostPaht+projectName;
		    }
		    
		     layui.use(['laydate','laypage','table','element'],function(){
		    	 var table = layui.table;
		    	 //第一个实例
		    	 table.render({
		    		 elem : '#orderList' ,
		    		 url  : getURL()+'/findOrderListByCondition' ,
		    		 page : true ,  //开启分页 
		    		 done : function(res,curr,count){
		    			 console.log("查看回调函数");
		    			 console.log(res);
		    		 },
		    		 id : 'reloadList',
		    		 cols : [ [
                                {type:'checkbox'},
		    		            {field:'id', width:80,title :'ID'  ,sort: true},
                                {field:'buyerName',title:'购买人姓名', width:80},
                                {field:'tel',title:'电话', width:80},
                                {field:'address',title:'地址'},
                                {field:'variety',title:'化肥品种'},
                                {field:'unitPrice',title:'单价 （元/斤）', sort: true},
                                {field:'count',title:'数量总数（斤）', sort: true},
                                {field:'totalPrice' ,title:'总金额',sort: true},
                                {field:'payPrice',title:'已付金额', sort: true},
                                {field:'owePrice',title:'所欠金额', sort: true},
                                {field:'date',title:'购买日期 ', sort: true},
                                {field:'payStatus',title:'结算状态 ',templet: '#statusTpl'},//这里的templet值是模板元素的选择器
                                {fixed: 'right', width:178, align:'center', toolbar: '#barDemo'}
		    	      ]
		    		 ]
		    	 });
		    	 //监听工具条    demo是table标签中lay-filter="demo" 的属性
		    	 table.on('tool(demo)',function(obj){
                    console.log(obj.data);
		    		 if(obj.event == "del"){
		    			 layer.confirm('真的要一次性结算吗',function(index){
		    			     $.ajax({
		 						type : "POST",
		 						//请求地址
		 			            url : getURL()+"/delOrderList",
		 			            dataType:'json',
		 			           contentType : "application/json;charset=utf-8",
		 			          //数据，json字符串
		 			            data : JSON.stringify(obj.data),
		 			            success:function(data){

		 			            	if (data.result =="success") {
		 		                        layer.msg('结算成功');
		 		                       //表格重载  
		 		                       table.reload('reloadList', {
		 		                    	  page: {
		 		                             curr: 1 //重新从第 1 页开始
		 		                           }
		 		                       });
		 		                    }else if(data.result == "defeat") {
		 		                        layer.msg('结算失败');
		 		                        
		 		                    }else{
		 		                    	layer.msg('结算失败');
		 		                    }
		 			            }
		 					});
		    			 })
		    		 }
		    	 });
		    	 
		     });
		</script>
	</body>

</html>